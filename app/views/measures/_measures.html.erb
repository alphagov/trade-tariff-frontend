<nav class="nav-tabs" role="navigation">
  <ul>
    <li class='active'>
      <a href="#overview" data-toggle="tab">Overview</a>
    </li>
    <li>
      <a href="#import" data-toggle="tab">Import</a>
    </li>
    <li>
      <a href="#export" data-toggle="tab">Export</a>
    </li>
    <li>
      <a href="#footnotes" data-toggle="tab">Footnotes</a>
    </li>
  </ul>
</nav>

<div id="measures-js" class='tab-content'>
  <article class='tab-pane active' id='overview'>
    <div class="inner">
      <h1 class="visuallyhidden">Overview</h1>
      <h2>Import</h2>
			<p>The commodity code for importing is <em><%= measurable.code %></em>.</p>
      <p>Importing from outside the EU is subject to a third country duty of <em><%= measurable.third_country_duty_rate %></em>.</p>
      <% measurable.import_measures.select{|m| m.national? && m.vat? }.each do |measure| %>
        <p>Goods are subject to <%= measure.measure_type_description %> of <em><%= measure.duty_expression %></em>.</p>
      <% end %>
      <h2>Export</h2>
			<p>The commodity code for exporting and intrastat reporting is <em><%= measurable.display_export_code %></em>.</p>

      <div class="help-notice">
        <p> See <a href="#import" data-toggle='tab'>import</a> and <a href="#export" data-toggle='tab'>export</a> tables for country-specific measures and restrictions.</p>
      </div>

      <h2>Binding Tariff Information</h2>
      <p><%= link_to "You can search the EU EBTI-database for existing Binding Tariff Information for this commodity code", measurable.bti_url, rel: "external", target: "_blank", title: "Opens in a new window" %></p>
      <nav class="part-pagination return-to-top">
        <a href="#wrapper">Return to top &uarr;</a>
      </nav>
    </div>
  </article>
  <article class='tab-pane' id='import' data-id="<%= measurable.to_param %>" data-class="<%=measurable.class.name.downcase.pluralize %>">
    <div class="inner">
      <table>
        <caption>Third country measures:</caption>
        <thead>
          <tr>
            <th scope="col">&nbsp;</th>

            <th scope="col">Measure Type</th>

            <th scope="col">Duty rates / prohibitions</th>

            <th scope="col">Additional codes</th>

            <th scope="col">Conditions</th>

            <th scope="col">Exclusions</th>

            <th scope="col" class="legal-act external-link" title="Links open externally">Legal Act</th>

            <th scope="col">Footnote</th>
          </tr>
        </thead>

        <tbody>
          <% measurable.import_measures.select(&:third_country).group_by(&:geographical_area_type).each do |group, measures| %>
            <%= render partial: "measures/measure", collection: measures.sort_by(&:sort_key), locals: { measure_group: "third_country" } %>
          <% end %>
        </tbody>
      </table>

      <table>
        <caption>Measures for specific countries and country groups:</caption>
        <thead>
          <tr>
            <th>&nbsp;</th>

            <th>Country</th>

            <th>Measure Type</th>

            <th>Duty rates / prohibitions</th>

            <th>Additional codes</th>

            <th>Conditions</th>

            <th>Exclusions</th>

            <th class="legal-act external-link" title="Links open externally">Legal Act</th>

            <th>Footnotes</th>
          </tr>
        </thead>

        <tbody>
        <% if measurable.import_measures.select(&:for_specific_countries).any? %>
          <% measurable.import_measures.select(&:for_specific_countries).group_by(&:geographical_area_type).each do |group, measures| %>
            <%= render partial: "measures/measure", collection: measures.sort_by(&:geographical_area_description), locals: { measure_group: "specific_country" } %>
          <% end %>
        <% else %>
          <tr>
            <td><div class="flag eu"></div></td>
            <td colspan="8">There are no EU preference measures for this commodity on this date</td>
          </tr>
        <% end %>
        </tbody>
      </table>
      <nav class="part-pagination return-to-top">
        <a href="#wrapper">Return to top &uarr;</a>
      </nav>
    </div><!-- end .inner -->
  </article><!-- end .tab-pane -->
  <article class='tab-pane' id='export' data-id="<%= measurable.to_param %>" data-class="<%=measurable.class.name.downcase.pluralize %>">
    <div class="inner">
      <table>
        <caption>Third country measures:</caption>
        <thead>
          <tr>
            <th scope="col">&nbsp;</th>

            <th scope="col">Measure Type</th>

            <th scope="col">Duty rates / prohibitions</th>

            <th scope="col">Additional codes</th>

            <th scope="col">Conditions</th>

            <th scope="col">Exclusions</th>

            <th scope="col" class="legal-act external-link" title="Links open externally">Legal Act</th>

            <th scope="col">Footnote</th>
          </tr>
        </thead>
        <tbody>
        <% if measurable.export_measures.select(&:third_country).any? %>
          <% measurable.export_measures.select(&:third_country).group_by(&:geographical_area_type).each do |group, measures| %>
            <%= render partial: "measures/measure", collection: measures.sort_by(&:sort_key), locals: { measure_group: "third_country" } %>
          <% end %>
          <% unless measurable.export_measures.select(&:third_country).select(&:vat?).any? %>
            <tr>
              <td><div class="flag uk"></div></td>
              <td colspan="7">No VAT or Excise measures were found for this commodity on this date</td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td><div class="flag eu"></div></td>
            <td colspan="7">There are no EU third country measures for this commodity on this date</td>
          </tr>
          <tr>
            <td><div class="flag uk"></div></td>
            <td colspan="7">No VAT or Excise measures were found for this commodity on this date</td>
          </tr>
        <% end %>
        </tbody>
      </table>

      <table>
        <caption>Measures for specific countries and country groups:</caption>
        <thead>
          <tr>
            <th>&nbsp;</th>

            <th>Country</th>

            <th>Measure Type</th>

            <th>Duty rates / prohibitions</th>

            <th>Additional codes</th>

            <th>Conditions</th>

            <th>Exclusions</th>

            <th class="legal-act external-link" title="Links open externally">Legal Act</th>

            <th>Footnotes</th>
          </tr>
        </thead>

        <tbody>
        <% if measurable.export_measures.select(&:for_specific_countries).any? %>
          <% measurable.export_measures.select(&:for_specific_countries).group_by(&:geographical_area_type).each do |group, measures| %>
            <%= render partial: "measures/measure", collection: measures.sort_by(&:sort_key), locals: { measure_group: "specific_country" } %>
          <% end %>
        <% else %>
          <tr>
            <td><div class="flag eu"></div></td>
            <td colspan="8">There are no EU preference measures for this commodity on this date</td>
          </tr>
        <% end %>
        </tbody>
      </table>
      <nav class="part-pagination return-to-top">
        <a href="#wrapper">Return to top &uarr;</a>
      </nav>
    </div><!-- end .inner -->
  </article><!-- end .tab-pane -->
  <article class='tab-pane' id='footnotes' data-id="<%= measurable.to_param %>" data-class="<%=measurable.class.name.downcase.pluralize %>">
    <div class="inner">
      <table>
        <caption>Footnotes for commodity:</caption>
        <thead>
          <tr>
            <th>Code</th>

            <th>Description</th>
          </tr>
        </thead>

        <tbody>
          <%= render measurable.footnotes %>
        </tbody>
      </table>
      <nav class="part-pagination return-to-top">
        <a href="#wrapper">Return to top &uarr;</a>
      </nav>
    </div><!-- end .inner -->
  </article><!-- end .tab-pane -->
  <div class="inner">
    <% measurable.import_measures.select(&:third_country).group_by(&:geographical_area_type).each do |group, measures| %>
      <%= render partial: "measures/measure_references", collection: measures.sort_by(&:sort_key), as: 'measure', locals: { measure_group: "third_country" } %>
    <% end %>
    <% measurable.import_measures.select(&:for_specific_countries).group_by(&:geographical_area_type).each do |group, measures| %>
      <%= render partial: "measures/measure_references", collection: measures.sort_by(&:sort_key), as: 'measure', locals: { measure_group: "specific_country" } %>
    <% end %>
  </div>
  <div class="inner">
    <% measurable.export_measures.select(&:third_country).group_by(&:geographical_area_type).each do |group, measures| %>
      <%= render partial: "measures/measure_references", collection: measures.sort_by(&:sort_key), as: 'measure', locals: { measure_group: "third_country" } %>
    <% end %>
    <% measurable.export_measures.select(&:for_specific_countries).group_by(&:geographical_area_type).each do |group, measures| %>
      <%= render partial: "measures/measure_references", collection: measures.sort_by(&:sort_key), as: 'measure', locals: { measure_group: "specific_country" } %>
    <% end %>
  </div>
</div><!-- end .tab-content -->
